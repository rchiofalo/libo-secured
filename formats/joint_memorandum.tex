%=============================================================================
%
%                     JOINT MEMORANDUM FORMAT MODULE
%
%=============================================================================
%
% References:
%   - SECNAV M-5216.5 (DON Correspondence Manual), Chapter 7
%   - Ch 7, Para 7-1.2; Figure 7-4
%
% What It Is:
%   Same as Joint Letter, but uses "JOINT MEMORANDUM" designation
%   instead of "JOINT LETTER" above the From: line.
%
% Key Rules:
%   - Letterhead: Plain bond with typed command titles (senior on top)
%   - Dual ID blocks: Junior LEFT, Senior RIGHT
%   - "JOINT MEMORANDUM" typed above From: line
%   - From line: Senior commander listed FIRST
%   - Signatures: Junior LEFT (signs first), Senior RIGHT (signs last)
%
%=============================================================================


%=============================================================================
%                    COMMAND CONFIGURATION
%=============================================================================
% Commands are pre-defined in main.tex, format file just uses them.
% Junior command: left side, signs FIRST
% Senior command: right side, signs LAST


%=============================================================================
%                    JOINT MEMORANDUM LETTERHEAD
%=============================================================================
% Plain bond with typed command titles
% Senior command on TOP, Junior below
% ZIP codes in parentheses

\renewcommand{\printLetterhead}{%
    \begin{center}
        {\fontsize{10pt}{11pt}\selectfont\textbf{DEPARTMENT OF THE NAVY}}\\[6pt]
        {\fontsize{8pt}{9pt}\selectfont
            \MakeUppercase{\SeniorCommandName} (\SeniorCommandZip)\\
            \MakeUppercase{\JuniorCommandName} (\JuniorCommandZip)\\
            \ifdefempty{\CommonLocation}{}{\MakeUppercase{\CommonLocation}}
        }
    \end{center}
    \vspace*{0.25in}%
}


%=============================================================================
%                    DUAL ID BLOCKS AND DESIGNATION
%=============================================================================
% Junior command LEFT (signs first), Senior command RIGHT (signs last)
% "JOINT MEMORANDUM" typed at left margin above From: line

\newcommand{\printDateAndTitle}{%
    % Dual ID symbols - side by side
    \noindent
    \begin{tabular}[t]{@{}p{3in}@{\hfill}p{3in}@{}}
        % Junior command (LEFT) - signs FIRST
        \begin{tabular}[t]{@{}l@{}}
            \optionalLine{\JuniorCommandCode}%
            \optionalLine{\JuniorSSIC}%
            \optionalLine{\JuniorSerial}%
            \optionalField{\JuniorDate}%
        \end{tabular}
        &
        % Senior command (RIGHT) - signs LAST
        \begin{tabular}[t]{@{}l@{}}
            \optionalLine{\SeniorCommandCode}%
            \optionalLine{\DocumentSSIC}%
            \optionalLine{\DocumentSerial}%
            \optionalField{\DocumentDate}%
        \end{tabular}
    \end{tabular}
    \par\vspace{24pt}%
    %
    % JOINT MEMORANDUM designation
    \noindent JOINT MEMORANDUM\\[12pt]
}


%=============================================================================
%                    FROM / TO / SUBJ BLOCK
%=============================================================================
% From: Senior commander listed FIRST, then junior
% Standard To: and Subj: lines

\newcommand{\printAddressBlock}{%
    \noindent
    \begin{tabular}[t]{@{}l@{\hspace{1em}}p{5.5in}@{}}
        From: & \SeniorFromLine\tabularnewline
              & \JuniorFromLine\tabularnewline
        To: & \ToLine\ifdefempty{\ToLineTwo}{}{\tabularnewline & \ToLineTwo}\ifdefempty{\ToLineThree}{}{\tabularnewline & \ToLineThree}\ifdefempty{\ToLineFour}{}{\tabularnewline & \ToLineFour}\tabularnewline
        \ifViaEnabled
            Via: & \ViaLineOne\ifdefempty{\ViaLineTwo}{}{\tabularnewline & \ViaLineTwo}\ifdefempty{\ViaLineThree}{}{\tabularnewline & \ViaLineThree}\ifdefempty{\ViaLineFour}{}{\tabularnewline & \ViaLineFour}\tabularnewline
        \fi
        & \tabularnewline[-6pt]
        Subj: & \SubjectLine\tabularnewline
    \end{tabular}%
    %
    % CUI block
    \ifCUIEnabled
        \\[12pt]%
        \noindent
        Controlled by: \CUIControlledBy\\
        CUI Category: \CUICategory\\
        Limited Dissemination Control: \CUIDissemination\\
        POC: \href{mailto:\POCEmail}{\POCEmail}%
        \\[12pt]%
        \noindent\CUIDistStatement
    \fi
    %
    % Classified block
    \ifClassifiedEnabled
        \\[12pt]%
        \noindent
        Classified by: \ClassifiedBy\\
        Derived from: \DerivedFrom\\
        Reason: \ClassificationReason\\
        Declassify on: \DeclassifyOn\\
        POC: \href{mailto:\POCEmail}{\POCEmail}
    \fi
}


%=============================================================================
%                    DUAL SIGNATURE BLOCK
%=============================================================================
% Junior signs on LEFT (signs FIRST)
% Senior signs on RIGHT (signs LAST)
% NO overscoring (unlike MOA/MOU)

\newcommand{\printSignature}{%
    \vspace{48pt}%
    \noindent
    \begin{tabular}[t]{@{}p{3in}@{\hfill}p{3in}@{}}
        % Junior command signature (LEFT) - signs FIRST
        \begin{minipage}[t]{2.5in}
            \raggedright
            \MakeUppercase{\JuniorSignatoryName}\\
            \optionalField{\JuniorSignatoryTitle}%
        \end{minipage}
        &
        % Senior command signature (RIGHT) - signs LAST
        \begin{minipage}[t]{2.5in}
            \raggedright
            \ifNotEmptyElse{\SignatoryAbbrev}{\SignatoryAbbrev\\}{\MakeUppercase{\SignatoryName}\\}%
            \optionalField{\SignatoryTitle}%
        \end{minipage}
    \end{tabular}
}


%=============================================================================
%                              PAGE STYLE
%=============================================================================

\fancypagestyle{documentpage}{%
    \fancyhf{}%
    \fancyhead[C]{\placeClassificationMarkings}%
    \fancyfoot[C]{\thepage\ of \pageref{LastPage}}%
    \renewcommand{\headrulewidth}{0pt}%
    \renewcommand{\footrulewidth}{0pt}%
}
