%=============================================================================
%
%                   NEW-PAGE ENDORSEMENT FORMAT MODULE
%
%=============================================================================
%
% References:
%   - SECNAV M-5216.5 (DON Correspondence Manual), Chapter 9
%   - Figure 9-3
%
% What It's For:
%   Use an endorsement to forward comments, recommendations, or
%   information when correspondence is transmitted via your activity.
%
% When to Use New-Page:
%   - Endorsement won't fit on previous page
%   - MUST include SSIC, endorsement line identifying basic letter,
%     and use basic letter's subject
%
% Key Rules:
%   - Uses command letterhead
%   - SSIC required
%   - Subject line repeats basic letter's subject
%   - DO NOT repeat references already in basic letter
%   - DO NOT repeat enclosures already in basic letter
%   - Continue numbering sequences from basic letter
%   - Page number continues from basic letter
%
%=============================================================================


%=============================================================================
%                    ENDORSEMENT CONFIGURATION
%=============================================================================

\newcommand{\EndorsementOrdinal}{}      % FIRST, SECOND, THIRD, etc.
\newcommand{\BasicLetterID}{}           % e.g., "NAS Meridian ltr 5216 Ser 11/273 of 22 Apr 15"

\newcommand{\setEndorsement}[2]{%
    \renewcommand{\EndorsementOrdinal}{#1}%
    \renewcommand{\BasicLetterID}{#2}%
}


%=============================================================================
%                    DATE/SSIC BLOCK AND ENDORSEMENT LINE
%=============================================================================
% Uses letterhead with SSIC block
% Endorsement line: "[ORDINAL] ENDORSEMENT on [basic letter ID]"
% Position: Left margin, 2nd line below date line

\newcommand{\printDateAndTitle}{%
    \vspace*{0.5in}%
    \hfill
    \begin{tabular}[t]{@{}l@{}}
        \ifInReplyEnabled
            {\fontsize{5pt}{6pt}\selectfont IN REPLY REFER TO}\\
        \fi
        \DocumentSSIC\\
        \DocumentSerial\\
        \DocumentDate
    \end{tabular}\\[24pt]
    \noindent\MakeUppercase{\EndorsementOrdinal} ENDORSEMENT on \BasicLetterID\\[12pt]
}


%=============================================================================
%                    FROM / TO / VIA / SUBJ BLOCK
%=============================================================================
% Subject line REQUIRED - repeats basic letter's subject
% Via line only shows REMAINING addressees

\newcommand{\printAddressBlock}{%
    \noindent
    \begin{tabular}[t]{@{}l@{\hspace{1em}}p{5.5in}@{}}
        From: & \FromLine\ifdefempty{\FromLineTwo}{}{\tabularnewline & \FromLineTwo}\ifdefempty{\FromLineThree}{}{\tabularnewline & \FromLineThree}\ifdefempty{\FromLineFour}{}{\tabularnewline & \FromLineFour}\tabularnewline
        To: & \ToLine\ifdefempty{\ToLineTwo}{}{\tabularnewline & \ToLineTwo}\ifdefempty{\ToLineThree}{}{\tabularnewline & \ToLineThree}\ifdefempty{\ToLineFour}{}{\tabularnewline & \ToLineFour}\tabularnewline
        \ifViaEnabled
            Via: & \ViaLineOne\ifdefempty{\ViaLineTwo}{}{\tabularnewline & \ViaLineTwo}\ifdefempty{\ViaLineThree}{}{\tabularnewline & \ViaLineThree}\ifdefempty{\ViaLineFour}{}{\tabularnewline & \ViaLineFour}\tabularnewline
        \fi
        & \tabularnewline[-6pt]
        Subj: & \SubjectLine\tabularnewline
    \end{tabular}%
    %
    % CUI block
    \ifCUIEnabled
        \\[12pt]%
        \noindent
        Controlled by: \CUIControlledBy\\
        CUI Category: \CUICategory\\
        Limited Dissemination Control: \CUIDissemination\\
        POC: \href{mailto:\POCEmail}{\POCEmail}%
        \\[12pt]%
        \noindent\CUIDistStatement
    \fi
    %
    % Classified block
    \ifClassifiedEnabled
        \\[12pt]%
        \noindent
        Classified by: \ClassifiedBy\\
        Derived from: \DerivedFrom\\
        Reason: \ClassificationReason\\
        Declassify on: \DeclassifyOn\\
        POC: \href{mailto:\POCEmail}{\POCEmail}
    \fi
}


%=============================================================================
%                    SIGNATURE BLOCK
%=============================================================================
% Name only OR with "By direction"

\newcommand{\printSignature}{%
    \vspace{36pt}%
    \hspace{3.25in}%
    \begin{minipage}{3in}
        \raggedright
        \ifx\SignatureImage\empty\else
            \IfFileExists{attachments/\SignatureImage}{%
                \includegraphics[width=1.5in,height=0.5in,keepaspectratio]{attachments/\SignatureImage}\\[6pt]%
            }{}%
        \fi
        \SignatoryAbbrev
    \end{minipage}
}


%=============================================================================
%                              PAGE STYLE
%=============================================================================
% Page number continues from basic letter

\fancypagestyle{documentpage}{%
    \fancyhf{}%
    \fancyhead[C]{\placeClassificationMarkings}%
    \fancyfoot[C]{\thepage}%
    \renewcommand{\headrulewidth}{0pt}%
    \renewcommand{\footrulewidth}{0pt}%
}
