<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>libo-secured | USMC Correspondence Generator</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <h1>libo-secured</h1>
    <p class="subtitle">"Libo isn't secured until the paperwork is done."</p>
    <div class="security-note">
        All data stays local in your browser. Nothing is sent to any server.
    </div>

    <!-- Profile & Draft Bar -->
    <div class="save-bar">
        <div class="save-bar-left">
            <select id="profileSelect" onchange="loadProfile()">
                <option value="">-- Select Profile --</option>
            </select>
            <button class="icon-btn" onclick="openProfileEditor()" title="Create/Edit Profile">+</button>
            <button class="icon-btn" onclick="editCurrentProfile()" title="Edit Selected Profile">‚úèÔ∏è</button>
            <button class="icon-btn" onclick="deleteProfile()" title="Delete Profile">üóëÔ∏è</button>
            <span class="save-bar-divider"></span>
            <button class="icon-btn" onclick="exportProfiles()" title="Export All Profiles">üì§</button>
            <button class="icon-btn" onclick="document.getElementById('importProfileInput').click()" title="Import Profiles">üì•</button>
            <input type="file" id="importProfileInput" accept=".json" style="display:none" onchange="importProfiles(event)">
        </div>
        <div class="save-bar-right">
            <span id="autoSaveStatus" class="auto-save-status"></span>
            <button class="icon-btn" onclick="clearDraft()" title="Clear Draft & Reset Form">üîÑ</button>
        </div>
    </div>

    <!-- Profile Editor Modal -->
    <div id="profileEditorModal" class="modal" style="display: none;">
        <div class="modal-content profile-editor-modal">
            <div class="modal-header">
                <h3 id="profileEditorTitle">Create New Profile</h3>
                <button class="modal-close" onclick="closeProfileEditor()">&times;</button>
            </div>
            <div class="profile-editor-body">
                <div class="profile-field">
                    <label for="profileName">Profile Name *</label>
                    <input type="text" id="profileName" placeholder="e.g., My Unit Profile">
                </div>
                <hr>
                <h4>Unit Information</h4>
                <div class="profile-field">
                    <label for="profileCommandName">Command Name</label>
                    <input type="text" id="profileCommandName" placeholder="e.g., MARINE CORPS DETACHMENT">
                </div>
                <div class="profile-field">
                    <label for="profileCommandAddress">Command Address</label>
                    <input type="text" id="profileCommandAddress" placeholder="e.g., 250 CHAMBERS AVENUE">
                </div>
                <div class="profile-field">
                    <label for="profileCommandCity">City, State ZIP</label>
                    <input type="text" id="profileCommandCity" placeholder="e.g., PENSACOLA, FLORIDA 32508-5217">
                </div>
                <div class="profile-field">
                    <label for="profileSSIC">Default SSIC</label>
                    <input type="text" id="profileSSIC" placeholder="e.g., 5216">
                </div>
                <hr>
                <h4>Signatory Information</h4>
                <div class="profile-row">
                    <div class="profile-field">
                        <label for="profileFirstName">First Name</label>
                        <input type="text" id="profileFirstName" placeholder="John">
                    </div>
                    <div class="profile-field">
                        <label for="profileMiddleInitial">M.I.</label>
                        <input type="text" id="profileMiddleInitial" placeholder="A." maxlength="3">
                    </div>
                    <div class="profile-field">
                        <label for="profileLastName">Last Name</label>
                        <input type="text" id="profileLastName" placeholder="Doe">
                    </div>
                </div>
                <div class="profile-row">
                    <div class="profile-field">
                        <label for="profileRank">Rank</label>
                        <input type="text" id="profileRank" placeholder="e.g., Sgt, USMC">
                    </div>
                    <div class="profile-field">
                        <label for="profileTitle">Title/Position</label>
                        <input type="text" id="profileTitle" placeholder="e.g., Operations NCO">
                    </div>
                </div>
                <div class="profile-field">
                    <label for="profileFromLine">From Line</label>
                    <input type="text" id="profileFromLine" placeholder="e.g., Commanding Officer, Marine Corps Detachment">
                </div>
            </div>
            <div class="modal-buttons">
                <button onclick="saveProfileFromEditor()" class="primary">Save Profile</button>
                <button onclick="closeProfileEditor()" class="secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Draft Restore Modal -->
    <div id="restoreModal" class="modal" style="display: none;">
        <div class="modal-content restore-modal">
            <h3>Restore Previous Work?</h3>
            <p>You have unsaved work from <strong id="restoreTimestamp"></strong>.</p>
            <p class="restore-hint">Would you like to continue where you left off?</p>
            <div class="modal-buttons">
                <button onclick="confirmRestore(true)" class="primary">Restore Draft</button>
                <button onclick="confirmRestore(false)" class="secondary">Start Fresh</button>
            </div>
        </div>
    </div>

    <!-- Reference Library Modal -->
    <div id="referenceLibraryModal" class="modal" style="display: none;">
        <div class="modal-content reference-library-modal">
            <div class="modal-header">
                <h3>üìö Reference Library</h3>
                <button class="modal-close" onclick="closeReferenceLibrary()">&times;</button>
            </div>
            <div class="reference-library-search">
                <input type="text" id="refLibrarySearch" placeholder="Search references (e.g., leave, PFT, awards...)" oninput="filterReferenceLibrary()">
                <select id="refLibraryCategory" onchange="filterReferenceLibrary()">
                    <option value="">All Categories</option>
                </select>
            </div>
            <div class="reference-library-list" id="refLibraryList">
                <!-- References will be populated here -->
            </div>
            <div class="modal-footer">
                <span class="ref-library-hint">Click a reference to add it to your document</span>
            </div>
        </div>
    </div>

    <!-- Mode Switcher -->
    <div class="mode-switcher">
        <button id="modeCorrespondence" class="mode-btn active" onclick="switchMode('correspondence')">
            Correspondence
        </button>
        <button id="modeForms" class="mode-btn disabled" disabled title="Coming soon: Fill out official USMC forms (Page 11, 6105, etc.)">
            Forms <span class="coming-soon">Coming Soon</span>
        </button>
    </div>

    <div class="container">
        <!-- FORMS PANEL (hidden by default) -->
        <div id="formsPanel" class="form-panel" style="display: none;">
            <h2>Select Form</h2>
            <select id="formTemplateSelect" onchange="selectFormTemplate()">
                <option value="">-- Select a form --</option>
                <optgroup label="Administrative">
                    <option value="navmc-118-11">NAVMC 118(11) - Page 11 Entry</option>
                    <option value="navmc-10274">NAVMC 10274 - Administrative Action (6105)</option>
                </optgroup>
            </select>

            <!-- Dynamic form fields will be inserted here -->
            <div id="formFields"></div>

            <!-- Signature Pad -->
            <div id="signatureSection" style="display: none;">
                <h2>Signature</h2>
                <div class="signature-pad-container">
                    <canvas id="signaturePad" width="400" height="150"></canvas>
                    <div class="signature-controls">
                        <button type="button" class="secondary" onclick="clearSignature()">Clear</button>
                    </div>
                </div>
                <p class="hint">Draw your signature above (touch or mouse)</p>
            </div>

            <!-- Form Actions -->
            <div id="formActions" style="display: none;">
                <div class="btn-row">
                    <button type="button" class="primary" onclick="generateFormPDF()">Generate PDF</button>
                    <button type="button" class="secondary" onclick="clearFormFields()">Clear Form</button>
                </div>
            </div>
        </div>

        <!-- CORRESPONDENCE PANEL -->
        <div id="correspondencePanel" class="form-panel">
            <h2>Document Type</h2>
            <select id="docType" onchange="updateDocTypeFields()">
                <optgroup label="Letters">
                    <option value="naval_letter" selected>Naval Letter (on letterhead)</option>
                    <option value="standard_letter">Standard Letter (plain bond)</option>
                    <option value="business_letter">Business Letter</option>
                    <option value="multiple_address_letter">Multiple-Address Letter</option>
                    <option value="joint_letter">Joint Letter</option>
                </optgroup>
                <optgroup label="Endorsements">
                    <option value="same_page_endorsement">Same-Page Endorsement</option>
                    <option value="new_page_endorsement">New-Page Endorsement</option>
                </optgroup>
                <optgroup label="Memorandums">
                    <option value="mfr">Memorandum for the Record (MFR)</option>
                    <option value="plain_paper_memorandum">Plain-Paper Memorandum</option>
                    <option value="letterhead_memorandum">Letterhead Memorandum</option>
                    <option value="decision_memorandum">Decision Memorandum</option>
                    <option value="moa">Memorandum of Agreement (MOA)</option>
                    <option value="mou">Memorandum of Understanding (MOU)</option>
                    <option value="joint_memorandum">Joint Memorandum</option>
                </optgroup>
                <optgroup label="Executive Memorandums">
                    <option value="standard_memorandum">Standard Memorandum</option>
                    <option value="action_memorandum">Action Memorandum</option>
                    <option value="information_memorandum">Information Memorandum</option>
                </optgroup>
                <optgroup label="USMC-Specific">
                    <option value="mf">"Memorandum For" (CMC/ACMC)</option>
                </optgroup>
            </select>

            <h2>Format Options</h2>
            <!-- Regulation hints panel -->
            <div id="regulationHints" class="regulation-hints" style="display: none;">
                <div class="regulation-header">SECNAV M-5216.5 Recommended:</div>
                <div id="regulationContent"></div>
            </div>
            <div class="row">
                <div>
                    <label>Font Size</label>
                    <select id="fontSize" onchange="updatePreview(); updateRegulationHighlights()">
                        <option value="12pt" selected>12pt</option>
                        <option value="10pt">10pt</option>
                    </select>
                    <span id="fontSizeHint" class="reg-hint"></span>
                </div>
                <div>
                    <label>Font Family</label>
                    <select id="fontFamily" onchange="updatePreview(); updateRegulationHighlights()">
                        <option value="courier" selected>Courier New</option>
                        <option value="times">Times New Roman</option>
                    </select>
                    <span id="fontFamilyHint" class="reg-hint"></span>
                </div>
            </div>
            <div class="row">
                <div>
                    <label>Page Numbers</label>
                    <select id="pageNumberStyle" onchange="updatePreview()">
                        <option value="xofy" selected>1 of X, 2 of X...</option>
                        <option value="simple">2, 3, 4... (no first page)</option>
                        <option value="none">No page numbers</option>
                    </select>
                </div>
            </div>

            <h2>Letterhead</h2>
            <label>Select from Known Units</label>
            <select id="unitSelect" onchange="selectUnit()">
                <option value="">-- Select a unit or type below --</option>
            </select>

            <label>Unit Name (Line 1)</label>
            <input type="text" id="unitLine1" value="1ST BATTALION, 6TH MARINES" oninput="updatePreview()">

            <label>Higher HQ (Line 2)</label>
            <input type="text" id="unitLine2" value="6TH MARINE REGIMENT" oninput="updatePreview()">

            <label>Address (Lines 3-4)</label>
            <input type="text" id="unitAddress" value="PSC BOX 20123, CAMP LEJEUNE, NC 28542" oninput="updatePreview()">

            <h2>Document Info</h2>
            <div class="checkbox-row">
                <input type="checkbox" id="inReplyTo" onchange="updatePreview()">
                <label for="inReplyTo" class="checkbox-label">IN REPLY REFER TO (for replies to previous
                    correspondence)</label>
            </div>
            <div class="row">
                <div>
                    <label>SSIC</label>
                    <input type="text" id="ssic" value="5216" oninput="updatePreview()" list="ssic-list">
                    <datalist id="ssic-list"></datalist>
                </div>
                <div>
                    <label>Serial</label>
                    <input type="text" id="serial" value="Ser ADM/001" oninput="updatePreview()">
                </div>
                <div>
                    <label>Date</label>
                    <input type="text" id="date" value="1 Jan 2025" oninput="updatePreview()">
                </div>
            </div>

            <!-- Standard Addressing (shown for most doc types) -->
            <div id="standardAddressing">
                <h2>Addressing</h2>
                <label>From</label>
                <input type="text" id="from" value="Commanding Officer, 1st Battalion, 6th Marines"
                    oninput="updatePreview()">

                <label>To</label>
                <input type="text" id="to" value="Commanding Officer, 6th Marine Regiment" oninput="updatePreview()">

                <label>Via (optional - one per line)</label>
                <textarea id="via" class="small" oninput="updatePreview()" placeholder="(1) Company Commander, Alpha Company
(2) Commanding Officer, 1st Battalion"></textarea>

                <label>Subject</label>
                <input type="text" id="subject" value="REQUEST FOR ADMINISTRATIVE SUPPORT" oninput="updatePreview()">
            </div>

            <!-- MOA/MOU Dual Command Fields -->
            <div id="moaFields" style="display: none;">
                <h2>Senior Command (Signs Last)</h2>
                <label>Command Name</label>
                <input type="text" id="seniorCommandName" value="" placeholder="HEADQUARTERS, U.S. MARINE CORPS" oninput="updatePreview()">
                <div class="row">
                    <div>
                        <label>SSIC</label>
                        <input type="text" id="seniorSSIC" value="" oninput="updatePreview()">
                    </div>
                    <div>
                        <label>Serial</label>
                        <input type="text" id="seniorSerial" value="" oninput="updatePreview()">
                    </div>
                    <div>
                        <label>Date</label>
                        <input type="text" id="seniorDate" value="" oninput="updatePreview()">
                    </div>
                </div>

                <h2>Junior Command (Signs First)</h2>
                <label>Command Name</label>
                <input type="text" id="juniorCommandName" value="" placeholder="1ST MARINE DIVISION" oninput="updatePreview()">
                <div class="row">
                    <div>
                        <label>SSIC</label>
                        <input type="text" id="juniorSSIC" value="" oninput="updatePreview()">
                    </div>
                    <div>
                        <label>Serial</label>
                        <input type="text" id="juniorSerial" value="" oninput="updatePreview()">
                    </div>
                    <div>
                        <label>Date</label>
                        <input type="text" id="juniorDate" value="" oninput="updatePreview()">
                    </div>
                </div>

                <h2>Subject</h2>
                <label>Subject</label>
                <input type="text" id="moaSubject" value="" placeholder="AGREEMENT REGARDING..." oninput="updatePreview()">
            </div>

            <!-- Joint Letter/Memo Dual Command Fields -->
            <div id="jointFields" style="display: none;">
                <h2>Senior Command (Right Side, Signs Last)</h2>
                <label>Command Name</label>
                <input type="text" id="jointSeniorName" value="" placeholder="NAVAL SEA SYSTEMS COMMAND" oninput="updatePreview()">
                <label>Command Code</label>
                <input type="text" id="jointSeniorCode" value="" placeholder="NAVSEA" oninput="updatePreview()">
                <label>ZIP Code</label>
                <input type="text" id="jointSeniorZip" value="" placeholder="20362" oninput="updatePreview()">
                <label>From Line</label>
                <input type="text" id="jointSeniorFrom" value="" placeholder="Commander, Naval Sea Systems Command" oninput="updatePreview()">

                <h2>Junior Command (Left Side, Signs First)</h2>
                <label>Command Name</label>
                <input type="text" id="jointJuniorName" value="" placeholder="NAVAL SUPPLY SYSTEMS COMMAND" oninput="updatePreview()">
                <label>Command Code</label>
                <input type="text" id="jointJuniorCode" value="" placeholder="NAVSUP" oninput="updatePreview()">
                <label>ZIP Code</label>
                <input type="text" id="jointJuniorZip" value="" placeholder="17050" oninput="updatePreview()">
                <div class="row">
                    <div>
                        <label>SSIC</label>
                        <input type="text" id="jointJuniorSSIC" value="" oninput="updatePreview()">
                    </div>
                    <div>
                        <label>Serial</label>
                        <input type="text" id="jointJuniorSerial" value="" oninput="updatePreview()">
                    </div>
                    <div>
                        <label>Date</label>
                        <input type="text" id="jointJuniorDate" value="" oninput="updatePreview()">
                    </div>
                </div>
                <label>From Line</label>
                <input type="text" id="jointJuniorFrom" value="" placeholder="Commander, Naval Supply Systems Command" oninput="updatePreview()">

                <h2>Common Location (if same city)</h2>
                <input type="text" id="jointCommonLocation" value="" placeholder="WASHINGTON, DC" oninput="updatePreview()">

                <h2>Addressing</h2>
                <label>To</label>
                <input type="text" id="jointTo" value="" oninput="updatePreview()">
                <label>Subject</label>
                <input type="text" id="jointSubject" value="" oninput="updatePreview()">
            </div>

            <h2 class="collapsible collapsed" onclick="toggleSection(this)">Classification / CUI</h2>
            <div class="collapsible-content hidden">
                <label>Classification Level</label>
                <select id="classLevel" onchange="updateClassFields(); updatePreview()">
                    <option value="unclassified" selected>UNCLASSIFIED</option>
                    <option value="cui">CUI (Controlled Unclassified Information)</option>
                    <option value="confidential">CONFIDENTIAL</option>
                    <option value="secret">SECRET</option>
                    <option value="top_secret">TOP SECRET</option>
                    <option value="top_secret_sci">TOP SECRET//SCI</option>
                </select>

                <!-- CUI Fields (shown when CUI selected) -->
                <div id="cuiFields" style="display: none;">
                    <label>Controlled By</label>
                    <input type="text" id="cuiControlledBy" value="DOD" oninput="updatePreview()">

                    <label>CUI Category</label>
                    <select id="cuiCategory" onchange="updatePreview()">
                        <option value="PRVCY">PRVCY - Privacy</option>
                        <option value="OPSEC">OPSEC - Operations Security</option>
                        <option value="FOUO">FOUO - For Official Use Only</option>
                        <option value="LES">LES - Law Enforcement Sensitive</option>
                        <option value="PROPIN">PROPIN - Proprietary Information</option>
                        <option value="EXPT">EXPT - Export Controlled</option>
                    </select>

                    <label>Dissemination Control</label>
                    <select id="cuiDissemination" onchange="updatePreview()">
                        <option value="FEDCON">FEDCON - Federal and Contractors</option>
                        <option value="FED ONLY">FED ONLY - Federal Employees Only</option>
                        <option value="NOCON">NOCON - No Contractor Access</option>
                        <option value="NOFORN">NOFORN - No Foreign Nationals</option>
                        <option value="DL ONLY">DL ONLY - Dissemination List Only</option>
                    </select>

                    <label>Distribution Statement</label>
                    <textarea id="cuiDistStatement" class="small"
                        oninput="updatePreview()">Distribution authorized to DoD and DoD contractors only.</textarea>

                    <label>POC Email</label>
                    <input type="email" id="pocEmail" value="" placeholder="name@usmc.mil" oninput="updatePreview()">
                </div>

                <!-- Classified Fields (shown when CONFIDENTIAL/SECRET/TS selected) -->
                <div id="classifiedFields" style="display: none;">
                    <div class="security-warning"
                        style="background: #5c1a1a; color: #f8d7da; padding: 8px; margin: 10px 0; border-radius: 4px; font-size: 10px;">
                        ‚ö†Ô∏è WARNING: Only process classified documents on systems authorized for that classification
                        level.
                    </div>

                    <label>Classified By</label>
                    <input type="text" id="classifiedBy" value="" placeholder="Original Classification Authority"
                        oninput="updatePreview()">

                    <label>Derived From</label>
                    <input type="text" id="derivedFrom" value="Multiple Sources" oninput="updatePreview()">

                    <label>Classification Reason</label>
                    <select id="classReason" onchange="updatePreview()">
                        <option value="1.4(a)">1.4(a) - Military plans, operations, or systems</option>
                        <option value="1.4(b)">1.4(b) - Foreign government information</option>
                        <option value="1.4(c)">1.4(c) - Intelligence activities, sources, methods</option>
                        <option value="1.4(d)">1.4(d) - Foreign relations or activities</option>
                        <option value="1.4(e)">1.4(e) - Scientific, technological, economic matters</option>
                        <option value="1.4(f)">1.4(f) - U.S. Government programs for nuclear materials</option>
                        <option value="1.4(g)">1.4(g) - Vulnerabilities or capabilities of systems</option>
                        <option value="1.4(h)">1.4(h) - Weapons of mass destruction</option>
                    </select>

                    <label>Declassify On (YYYYMMDD)</label>
                    <input type="text" id="declassifyOn" value="" placeholder="20350101" oninput="updatePreview()">

                    <label>POC Email</label>
                    <input type="email" id="classifiedPocEmail" value="" placeholder="name@usmc.mil"
                        oninput="updatePreview()">
                </div>
            </div>

            <h2 class="collapsible" onclick="toggleSection(this)">References & Enclosures</h2>
            <div class="collapsible-content">
                <div class="references-header">
                    <label>References</label>
                    <span class="references-hint">auto-letters (a), (b), (c)... - drag to reorder</span>
                </div>
                <div id="referencesList" class="references-list"></div>
                <div class="reference-add-row">
                    <button type="button" class="btn-add-reference" onclick="addReference()">+ Add Reference</button>
                    <button type="button" class="btn-reference-library" onclick="openReferenceLibrary()">üìö Reference Library</button>
                </div>

                <div class="enclosures-header">
                    <label>Enclosures</label>
                    <span class="enclosures-hint">auto-numbers (1), (2), (3)... - drag to reorder</span>
                </div>
                <div id="enclosuresList" class="enclosures-list"></div>
                <div class="enclosure-add-row">
                    <button type="button" class="btn-add-enclosure" onclick="addEnclosure()">+ Add Enclosure</button>
                    <div class="enclosure-drop-zone" id="enclDropZone">
                        <input type="file" id="enclFileUpload" accept=".pdf" multiple
                            onchange="handleEnclFileUpload(event)">
                        <span>or drop PDF here</span>
                    </div>
                </div>
            </div>

            <h2>Body</h2>
            <textarea id="body" oninput="updatePreview()">1.  Per reference (a), this correspondence serves as an example of the naval letter format.

2.  The purpose of this letter is to demonstrate proper formatting in accordance with SECNAV M-5216.5.

3.  Point of contact for this matter is the undersigned at (910) 555-1234.</textarea>

            <!-- Standard Signature (for most doc types) -->
            <div id="standardSignature">
                <h2>Signature</h2>
                <div class="row">
                    <div>
                        <label>First Name</label>
                        <input type="text" id="sigFirst" value="John" oninput="updatePreview()">
                    </div>
                    <div style="flex: 0.5;">
                        <label>M.I.</label>
                        <input type="text" id="sigMiddle" value="A." oninput="updatePreview()">
                    </div>
                    <div>
                        <label>Last Name</label>
                        <input type="text" id="sigLast" value="Doe" oninput="updatePreview()">
                    </div>
                </div>
                <div class="row">
                    <div>
                        <label>Rank</label>
                        <input type="text" id="sigRank" value="Sgt, USMC" oninput="updatePreview()">
                    </div>
                    <div>
                        <label>Title</label>
                        <input type="text" id="sigTitle" value="Operations NCO" oninput="updatePreview()">
                    </div>
                </div>
                <div class="checkbox-row">
                    <label class="checkbox-label">
                        <input type="checkbox" id="byDirection" onchange="updateByDirectionFields(); updatePreview()">
                        <span>By direction</span>
                    </label>
                    <input type="text" id="byDirectionAuthority" placeholder="e.g., the Commanding Officer"
                           oninput="updatePreview()" style="flex: 1; display: none;">
                </div>
            </div>

            <!-- MOA/MOU Dual Signatures -->
            <div id="moaSignatures" style="display: none;">
                <h2>Senior Command Signatory (Signs Last)</h2>
                <div class="row">
                    <div>
                        <label>Name</label>
                        <input type="text" id="seniorSigName" value="" oninput="updatePreview()">
                    </div>
                    <div>
                        <label>Rank</label>
                        <input type="text" id="seniorSigRank" value="" oninput="updatePreview()">
                    </div>
                    <div>
                        <label>Title</label>
                        <input type="text" id="seniorSigTitle" value="" oninput="updatePreview()">
                    </div>
                </div>

                <h2>Junior Command Signatory (Signs First)</h2>
                <div class="row">
                    <div>
                        <label>Name</label>
                        <input type="text" id="juniorSigName" value="" oninput="updatePreview()">
                    </div>
                    <div>
                        <label>Rank</label>
                        <input type="text" id="juniorSigRank" value="" oninput="updatePreview()">
                    </div>
                    <div>
                        <label>Title</label>
                        <input type="text" id="juniorSigTitle" value="" oninput="updatePreview()">
                    </div>
                </div>
            </div>

            <!-- Joint Letter/Memo Dual Signatures -->
            <div id="jointSignatures" style="display: none;">
                <h2>Senior Command Signatory (Signs Last)</h2>
                <div class="row">
                    <div>
                        <label>Name</label>
                        <input type="text" id="jointSeniorSigName" value="" oninput="updatePreview()">
                    </div>
                    <div>
                        <label>Title</label>
                        <input type="text" id="jointSeniorSigTitle" value="" oninput="updatePreview()">
                    </div>
                </div>

                <h2>Junior Command Signatory (Signs First)</h2>
                <div class="row">
                    <div>
                        <label>Name</label>
                        <input type="text" id="jointJuniorSigName" value="" oninput="updatePreview()">
                    </div>
                    <div>
                        <label>Title</label>
                        <input type="text" id="jointJuniorSigTitle" value="" oninput="updatePreview()">
                    </div>
                </div>
            </div>

            <div class="btn-row">
                <button class="primary" onclick="downloadLatexPDF()">Download PDF</button>
            </div>
            <div class="btn-row">
                <button class="secondary" onclick="downloadConfigs()">Download Configs</button>
                <button class="secondary" onclick="downloadTeX()">Download .tex</button>
            </div>

            <!-- Show Preview button (visible when preview is hidden on desktop) -->
            <div id="showPreviewBtn" class="show-preview-btn" style="display: none;">
                <button onclick="togglePreviewPanel()">Show Preview</button>
            </div>

            <div id="status" class="status" style="display: none;"></div>
        </div>

        <!-- PDF PREVIEW PANEL -->
        <div class="preview-panel" id="pdfPreviewPanel">
            <div class="pdf-preview-header">
                <span class="pdf-preview-title">PDF Preview</span>
                <div class="pdf-header-buttons">
                    <button class="pdf-refresh-btn" onclick="refreshPdfPreview()" title="Refresh Preview">&#x21bb;</button>
                    <button class="pdf-toggle-btn" id="previewToggleBtn" onclick="togglePreviewPanel()" title="Hide Preview">&#x2715;</button>
                </div>
            </div>
            <div class="pdf-preview-status" id="pdfPreviewStatus">
                <span class="pdf-loading">Initializing LaTeX engine...</span>
            </div>
            <iframe id="pdfPreviewFrame" class="pdf-preview-frame"></iframe>
        </div>

        <!-- Hidden HTML preview elements (kept for compatibility but not displayed) -->
        <div style="display: none;">
            <div id="prev-class-banner-top"></div>
            <div id="prev-letterhead">
                <img id="prev-seal">
                <div id="prev-unit1"></div>
                <div id="prev-unit2"></div>
                <div id="prev-address"></div>
            </div>
            <div id="prev-memo-header"></div>
            <div id="prev-in-reply"></div>
            <div id="prev-ssic-block">
                <span id="prev-ssic"></span>
                <span id="prev-serial"></span>
                <span id="prev-date"></span>
            </div>
            <div id="prev-date-only"></div>
            <div id="prev-from-block"><span id="prev-from"></span></div>
            <div id="prev-to-block"><span id="prev-to"></span></div>
            <div id="prev-via-block"><span id="prev-via"></span></div>
            <div><span id="prev-subject"></span></div>
            <div id="prev-cui-block">
                <span id="prev-cui-controlled"></span>
                <span id="prev-cui-category"></span>
                <span id="prev-cui-dissem"></span>
                <span id="prev-cui-poc"></span>
                <div id="prev-cui-dist"></div>
            </div>
            <div id="prev-classified-block">
                <span id="prev-class-by"></span>
                <span id="prev-derived-from"></span>
                <span id="prev-class-reason"></span>
                <span id="prev-declassify-on"></span>
                <span id="prev-class-poc"></span>
            </div>

            <!-- References -->
            <div class="ref-block" id="prev-ref-block">
                <span class="label">Ref:</span><span class="content" id="prev-refs">(a) SECNAV M-5216.5<br>(b) MCO
                    5216.20B</span>
            </div>

            <!-- Enclosures -->
            <div class="encl-block" id="prev-encl-block" style="display: none;">
                <span class="label">Encl:</span><span class="content" id="prev-encls"></span>
            </div>

            <!-- Body -->
            <div class="body-content" id="prev-body">1. Per reference (a), this correspondence serves as an example of
                the naval letter format.

                2. The purpose of this letter is to demonstrate proper formatting in accordance with SECNAV M-5216.5.

                3. Point of contact for this matter is the undersigned at (910) 555-1234.</div>

            <!-- Signature -->
            <div class="signature-block">
                <span id="prev-sig">J. A. DOE</span>
            </div>

            <!-- Classification Banner (bottom) -->
            <div class="class-banner class-banner-bottom" id="prev-class-banner-bottom" style="display: none;"></div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>

    <!-- SwiftLaTeX Engine -->
    <script src="lib/PdfTeXEngine.js?v=5"></script>

    <!-- LaTeX Templates -->
    <script src="js/latex-templates.js?v=16"></script>

    <!-- Bundled TeX Live Packages (avoids HTTP fetch issues) -->
    <script src="js/texlive-packages.js?v=10"></script>

    <!-- Application JavaScript -->
    <script src="js/app.js?v=32"></script>
</body>

</html>