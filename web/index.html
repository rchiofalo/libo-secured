<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>libo-secured | USMC Correspondence Generator</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <h1>libo-secured</h1>
    <p class="subtitle">"Libo isn't secured until the paperwork is done."</p>
    <div class="security-note">
        All data stays local in your browser. Nothing is sent to any server.
    </div>

    <div class="container">
        <!-- FORM PANEL -->
        <div class="form-panel">
            <h2>Document Type</h2>
            <select id="docType" oninput="updatePreview()">
                <optgroup label="Letters">
                    <option value="naval_letter" selected>Naval Letter (on letterhead)</option>
                    <option value="standard_letter">Standard Letter (plain bond)</option>
                    <option value="business_letter">Business Letter</option>
                    <option value="multiple_address_letter">Multiple-Address Letter</option>
                    <option value="joint_letter">Joint Letter</option>
                </optgroup>
                <optgroup label="Endorsements">
                    <option value="same_page_endorsement">Same-Page Endorsement</option>
                    <option value="new_page_endorsement">New-Page Endorsement</option>
                </optgroup>
                <optgroup label="Memorandums">
                    <option value="mfr">Memorandum for the Record (MFR)</option>
                    <option value="plain_paper_memorandum">Plain-Paper Memorandum</option>
                    <option value="letterhead_memorandum">Letterhead Memorandum</option>
                    <option value="decision_memorandum">Decision Memorandum</option>
                    <option value="moa">Memorandum of Agreement (MOA)</option>
                    <option value="mou">Memorandum of Understanding (MOU)</option>
                    <option value="joint_memorandum">Joint Memorandum</option>
                </optgroup>
                <optgroup label="Executive Memorandums">
                    <option value="standard_memorandum">Standard Memorandum</option>
                    <option value="action_memorandum">Action Memorandum</option>
                    <option value="information_memorandum">Information Memorandum</option>
                </optgroup>
                <optgroup label="USMC-Specific">
                    <option value="mf">"Memorandum For" (CMC/ACMC)</option>
                </optgroup>
            </select>

            <h2>Letterhead</h2>
            <label>Select from Known Units</label>
            <select id="unitSelect" onchange="selectUnit()">
                <option value="">-- Select a unit or type below --</option>
            </select>

            <label>Unit Name (Line 1)</label>
            <input type="text" id="unitLine1" value="1ST BATTALION, 6TH MARINES" oninput="updatePreview()">

            <label>Higher HQ (Line 2)</label>
            <input type="text" id="unitLine2" value="6TH MARINE REGIMENT" oninput="updatePreview()">

            <label>Address (Lines 3-4)</label>
            <input type="text" id="unitAddress" value="PSC BOX 20123, CAMP LEJEUNE, NC 28542" oninput="updatePreview()">

            <h2>Document Info</h2>
            <div class="checkbox-row">
                <input type="checkbox" id="inReplyTo" onchange="updatePreview()">
                <label for="inReplyTo" class="checkbox-label">IN REPLY REFER TO (for replies to previous
                    correspondence)</label>
            </div>
            <div class="row">
                <div>
                    <label>SSIC</label>
                    <input type="text" id="ssic" value="5216" oninput="updatePreview()" list="ssic-list">
                    <datalist id="ssic-list"></datalist>
                </div>
                <div>
                    <label>Serial</label>
                    <input type="text" id="serial" value="Ser ADM/001" oninput="updatePreview()">
                </div>
                <div>
                    <label>Date</label>
                    <input type="text" id="date" value="1 Jan 2025" oninput="updatePreview()">
                </div>
            </div>

            <h2>Addressing</h2>
            <label>From</label>
            <input type="text" id="from" value="Commanding Officer, 1st Battalion, 6th Marines"
                oninput="updatePreview()">

            <label>To</label>
            <input type="text" id="to" value="Commanding Officer, 6th Marine Regiment" oninput="updatePreview()">

            <label>Via (optional - one per line)</label>
            <textarea id="via" class="small" oninput="updatePreview()" placeholder="(1) Company Commander, Alpha Company
(2) Commanding Officer, 1st Battalion"></textarea>

            <label>Subject</label>
            <input type="text" id="subject" value="REQUEST FOR ADMINISTRATIVE SUPPORT" oninput="updatePreview()">

            <h2 class="collapsible collapsed" onclick="toggleSection(this)">Classification / CUI</h2>
            <div class="collapsible-content hidden">
                <label>Classification Level</label>
                <select id="classLevel" onchange="updateClassFields(); updatePreview()">
                    <option value="unclassified" selected>UNCLASSIFIED</option>
                    <option value="cui">CUI (Controlled Unclassified Information)</option>
                    <option value="confidential">CONFIDENTIAL</option>
                    <option value="secret">SECRET</option>
                    <option value="top_secret">TOP SECRET</option>
                    <option value="top_secret_sci">TOP SECRET//SCI</option>
                </select>

                <!-- CUI Fields (shown when CUI selected) -->
                <div id="cuiFields" style="display: none;">
                    <label>Controlled By</label>
                    <input type="text" id="cuiControlledBy" value="DOD" oninput="updatePreview()">

                    <label>CUI Category</label>
                    <select id="cuiCategory" onchange="updatePreview()">
                        <option value="PRVCY">PRVCY - Privacy</option>
                        <option value="OPSEC">OPSEC - Operations Security</option>
                        <option value="FOUO">FOUO - For Official Use Only</option>
                        <option value="LES">LES - Law Enforcement Sensitive</option>
                        <option value="PROPIN">PROPIN - Proprietary Information</option>
                        <option value="EXPT">EXPT - Export Controlled</option>
                    </select>

                    <label>Dissemination Control</label>
                    <select id="cuiDissemination" onchange="updatePreview()">
                        <option value="FEDCON">FEDCON - Federal and Contractors</option>
                        <option value="FED ONLY">FED ONLY - Federal Employees Only</option>
                        <option value="NOCON">NOCON - No Contractor Access</option>
                        <option value="NOFORN">NOFORN - No Foreign Nationals</option>
                        <option value="DL ONLY">DL ONLY - Dissemination List Only</option>
                    </select>

                    <label>Distribution Statement</label>
                    <textarea id="cuiDistStatement" class="small"
                        oninput="updatePreview()">Distribution authorized to DoD and DoD contractors only.</textarea>

                    <label>POC Email</label>
                    <input type="email" id="pocEmail" value="" placeholder="name@usmc.mil" oninput="updatePreview()">
                </div>

                <!-- Classified Fields (shown when CONFIDENTIAL/SECRET/TS selected) -->
                <div id="classifiedFields" style="display: none;">
                    <div class="security-warning"
                        style="background: #5c1a1a; color: #f8d7da; padding: 8px; margin: 10px 0; border-radius: 4px; font-size: 10px;">
                        ⚠️ WARNING: Only process classified documents on systems authorized for that classification
                        level.
                    </div>

                    <label>Classified By</label>
                    <input type="text" id="classifiedBy" value="" placeholder="Original Classification Authority"
                        oninput="updatePreview()">

                    <label>Derived From</label>
                    <input type="text" id="derivedFrom" value="Multiple Sources" oninput="updatePreview()">

                    <label>Classification Reason</label>
                    <select id="classReason" onchange="updatePreview()">
                        <option value="1.4(a)">1.4(a) - Military plans, operations, or systems</option>
                        <option value="1.4(b)">1.4(b) - Foreign government information</option>
                        <option value="1.4(c)">1.4(c) - Intelligence activities, sources, methods</option>
                        <option value="1.4(d)">1.4(d) - Foreign relations or activities</option>
                        <option value="1.4(e)">1.4(e) - Scientific, technological, economic matters</option>
                        <option value="1.4(f)">1.4(f) - U.S. Government programs for nuclear materials</option>
                        <option value="1.4(g)">1.4(g) - Vulnerabilities or capabilities of systems</option>
                        <option value="1.4(h)">1.4(h) - Weapons of mass destruction</option>
                    </select>

                    <label>Declassify On (YYYYMMDD)</label>
                    <input type="text" id="declassifyOn" value="" placeholder="20350101" oninput="updatePreview()">

                    <label>POC Email</label>
                    <input type="email" id="classifiedPocEmail" value="" placeholder="name@usmc.mil"
                        oninput="updatePreview()">
                </div>
            </div>

            <h2 class="collapsible" onclick="toggleSection(this)">References & Enclosures</h2>
            <div class="collapsible-content">
                <label>References (one per line: letter | title)</label>
                <textarea id="refs" class="small" oninput="updatePreview()" placeholder="a | SECNAV M-5216.5
b | MCO 5216.20B">a | SECNAV M-5216.5
b | MCO 5216.20B</textarea>
                <div class="hint">Format: a | Reference Title</div>

                <div class="enclosures-header">
                    <label>Enclosures</label>
                    <span class="enclosures-hint">auto-numbers (1), (2), (3)...</span>
                </div>
                <div id="enclosuresList" class="enclosures-list"></div>
                <div class="enclosure-add-row">
                    <button type="button" class="btn-add-enclosure" onclick="addEnclosure()">+ Add Enclosure</button>
                    <div class="enclosure-drop-zone" id="enclDropZone">
                        <input type="file" id="enclFileUpload" accept=".pdf" multiple
                            onchange="handleEnclFileUpload(event)">
                        <span>or drop PDF here</span>
                    </div>
                </div>
            </div>

            <h2>Body</h2>
            <textarea id="body" oninput="updatePreview()">1.  Per reference (a), this correspondence serves as an example of the naval letter format.

2.  The purpose of this letter is to demonstrate proper formatting in accordance with SECNAV M-5216.5.

3.  Point of contact for this matter is the undersigned at (910) 555-1234.</textarea>

            <h2>Signature</h2>
            <div class="row">
                <div>
                    <label>First Name</label>
                    <input type="text" id="sigFirst" value="John" oninput="updatePreview()">
                </div>
                <div style="flex: 0.5;">
                    <label>M.I.</label>
                    <input type="text" id="sigMiddle" value="A." oninput="updatePreview()">
                </div>
                <div>
                    <label>Last Name</label>
                    <input type="text" id="sigLast" value="Doe" oninput="updatePreview()">
                </div>
            </div>
            <div class="row">
                <div>
                    <label>Rank</label>
                    <input type="text" id="sigRank" value="Sgt, USMC" oninput="updatePreview()">
                </div>
                <div>
                    <label>Title</label>
                    <input type="text" id="sigTitle" value="Operations NCO" oninput="updatePreview()">
                </div>
            </div>

            <div class="btn-row">
                <button class="primary" onclick="downloadLatexPDF()">Download PDF (LaTeX)</button>
                <button onclick="downloadPDF()">Quick PDF</button>
            </div>
            <div class="btn-row">
                <button class="secondary" onclick="downloadConfigs()">Download Configs</button>
                <button class="secondary" onclick="downloadTeX()">Download .tex</button>
            </div>

            <div id="status" class="status" style="display: none;"></div>
        </div>

        <!-- PDF PREVIEW PANEL -->
        <div class="preview-panel" id="pdfPreviewPanel">
            <div class="pdf-preview-header">
                <span class="pdf-preview-title">PDF Preview</span>
                <button class="pdf-refresh-btn" onclick="refreshPdfPreview()" title="Refresh Preview">&#x21bb;</button>
            </div>
            <div class="pdf-preview-status" id="pdfPreviewStatus">
                <span class="pdf-loading">Initializing LaTeX engine...</span>
            </div>
            <iframe id="pdfPreviewFrame" class="pdf-preview-frame"></iframe>
        </div>

        <!-- Hidden HTML preview elements (kept for compatibility but not displayed) -->
        <div style="display: none;">
            <div id="prev-class-banner-top"></div>
            <div id="prev-letterhead">
                <img id="prev-seal">
                <div id="prev-unit1"></div>
                <div id="prev-unit2"></div>
                <div id="prev-address"></div>
            </div>
            <div id="prev-memo-header"></div>
            <div id="prev-in-reply"></div>
            <div id="prev-ssic-block">
                <span id="prev-ssic"></span>
                <span id="prev-serial"></span>
                <span id="prev-date"></span>
            </div>
            <div id="prev-date-only"></div>
            <div id="prev-from-block"><span id="prev-from"></span></div>
            <div id="prev-to-block"><span id="prev-to"></span></div>
            <div id="prev-via-block"><span id="prev-via"></span></div>
            <div><span id="prev-subject"></span></div>
            <div id="prev-cui-block">
                <span id="prev-cui-controlled"></span>
                <span id="prev-cui-category"></span>
                <span id="prev-cui-dissem"></span>
                <span id="prev-cui-poc"></span>
                <div id="prev-cui-dist"></div>
            </div>
            <div id="prev-classified-block">
                <span id="prev-class-by"></span>
                <span id="prev-derived-from"></span>
                <span id="prev-class-reason"></span>
                <span id="prev-declassify-on"></span>
                <span id="prev-class-poc"></span>
            </div>

            <!-- References -->
            <div class="ref-block" id="prev-ref-block">
                <span class="label">Ref:</span><span class="content" id="prev-refs">(a) SECNAV M-5216.5<br>(b) MCO
                    5216.20B</span>
            </div>

            <!-- Enclosures -->
            <div class="encl-block" id="prev-encl-block" style="display: none;">
                <span class="label">Encl:</span><span class="content" id="prev-encls"></span>
            </div>

            <!-- Body -->
            <div class="body-content" id="prev-body">1. Per reference (a), this correspondence serves as an example of
                the naval letter format.

                2. The purpose of this letter is to demonstrate proper formatting in accordance with SECNAV M-5216.5.

                3. Point of contact for this matter is the undersigned at (910) 555-1234.</div>

            <!-- Signature -->
            <div class="signature-block">
                <span id="prev-sig">J. A. DOE</span>
            </div>

            <!-- Classification Banner (bottom) -->
            <div class="class-banner class-banner-bottom" id="prev-class-banner-bottom" style="display: none;"></div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>

    <!-- SwiftLaTeX Engine -->
    <script src="lib/PdfTeXEngine.js?v=5"></script>

    <!-- LaTeX Templates -->
    <script src="js/latex-templates.js"></script>

    <!-- Bundled TeX Live Packages (avoids HTTP fetch issues) -->
    <script src="js/texlive-packages.js?v=10"></script>

    <!-- Application JavaScript -->
    <script src="js/app.js?v=11"></script>
</body>

</html>