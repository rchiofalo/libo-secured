%=============================================================================
%
%                   MEMORANDUM OF AGREEMENT (MOA) FORMAT MODULE
%
%=============================================================================
%
% References:
%   - SECNAV M-5216.5 (DON Correspondence Manual), Chapter 10, Para 6
%   - Figure 10-5
%
% What It's For:
%   Document mutual agreements between commands/activities regarding:
%   - Facts, Intentions, Procedures
%   - Limits on future actions
%   - Coordination (present or future)
%   - Commitments
%
% Key Rules:
%   - Paper: Senior command's letterhead (or plain bond with typed titles)
%   - Both commands include: SSIC, Serial number, Date
%   - Layout: Side by side â€” senior command on LEFT
%   - Title block: Centered, second line below date
%   - Signatures: Senior on RIGHT, Junior on LEFT (with overscoring)
%   - Senior signs AFTER junior
%
%=============================================================================


%=============================================================================
%                    COMMAND CONFIGURATION
%=============================================================================
% Commands are pre-defined in main.tex, format file just uses them.
% Junior command: left side, signs FIRST
% Senior command: right side, signs LAST
%
% For MOA/MOU, uses a subset of the Joint Letter fields:
%   - JuniorCommandName, JuniorSSIC, JuniorSerial, JuniorDate
%   - JuniorSignatoryName, JuniorSignatoryRank (from main.tex stubs)
%   - JuniorSignatoryTitle
%   - SeniorCommandName


%=============================================================================
%                    DUAL ID SYMBOLS AND TITLE BLOCK
%=============================================================================
% Both commands' ID symbols side by side
% Senior command on LEFT, Junior command on RIGHT
% Title block centered below

\newcommand{\printDateAndTitle}{%
    \vspace*{0.5in}%
    % Dual ID symbols - side by side
    \noindent
    \begin{tabular}[t]{@{}p{3in}@{\hfill}p{3in}@{}}
        % Senior command (LEFT)
        \begin{tabular}[t]{@{}l@{}}
            \optionalLine{\DocumentSSIC}%
            \optionalLine{\DocumentSerial}%
            \optionalField{\DocumentDate}%
        \end{tabular}
        &
        % Junior command (RIGHT)
        \begin{tabular}[t]{@{}l@{}}
            \optionalLine{\JuniorSSIC}%
            \optionalLine{\JuniorSerial}%
            \optionalField{\JuniorDate}%
        \end{tabular}
    \end{tabular}
    \par\vspace{24pt}%
    %
    % Title block - centered
    \begin{center}
        MEMORANDUM OF AGREEMENT\\
        BETWEEN\\
        \ifNotEmptyElse{\SeniorCommandName}{\MakeUppercase{\SeniorCommandName}}{[SENIOR COMMAND]}\\
        AND\\
        \ifNotEmptyElse{\JuniorCommandName}{\MakeUppercase{\JuniorCommandName}}{[JUNIOR COMMAND]}
    \end{center}
    \par\vspace{12pt}%
}


%=============================================================================
%                           SUBJECT BLOCK
%=============================================================================

\newcommand{\printAddressBlock}{%
    \noindent
    \begin{tabular}[t]{@{}l@{\hspace{1em}}p{5.5in}@{}}
        Subj: & \SubjectLine\tabularnewline
    \end{tabular}%
    %
    % CUI block
    \ifCUIEnabled
        \\[12pt]%
        \noindent
        Controlled by: \CUIControlledBy\\
        CUI Category: \CUICategory\\
        Limited Dissemination Control: \CUIDissemination\\
        POC: \href{mailto:\POCEmail}{\POCEmail}%
        \\[12pt]%
        \noindent\CUIDistStatement
    \fi
    %
    % Classified block
    \ifClassifiedEnabled
        \\[12pt]%
        \noindent
        Classified by: \ClassifiedBy\\
        Derived from: \DerivedFrom\\
        Reason: \ClassificationReason\\
        Declassify on: \DeclassifyOn\\
        POC: \href{mailto:\POCEmail}{\POCEmail}
    \fi
}


%=============================================================================
%                    DUAL SIGNATURE BLOCK (MOA Style)
%=============================================================================
% Junior signs on LEFT (signs first)
% Senior signs on RIGHT (signs last)
% Use overscoring (line above the name)

\newcommand{\printSignature}{%
    \vspace{48pt}%
    \noindent
    \begin{tabular}[t]{@{}p{3in}@{\hfill}p{3in}@{}}
        % Junior command signature (LEFT) - signs FIRST
        \begin{minipage}[t]{2.5in}
            \centering
            \rule{2in}{0.4pt}\\
            \MakeUppercase{\JuniorSignatoryName}\\
            \optionalLine{\JuniorSignatoryRank}%
            \optionalLine{\JuniorSignatoryTitle}%
            \optionalField{\JuniorByDirection}%
        \end{minipage}
        &
        % Senior command signature (RIGHT) - signs LAST
        \begin{minipage}[t]{2.5in}
            \centering
            \rule{2in}{0.4pt}\\
            \ifNotEmptyElse{\SignatoryAbbrev}{\SignatoryAbbrev\\}{\MakeUppercase{\SignatoryName}\\}%
            \optionalLine{\SignatoryRank}%
            \optionalLine{\SignatoryTitle}%
            \optionalField{\ByDirection}%
        \end{minipage}
    \end{tabular}
}


%=============================================================================
%                              PAGE STYLE
%=============================================================================
% SECNAV M-5216.5:
%   - First page: Do NOT number
%   - Second+ pages: Centered, 1/2" from bottom

\fancypagestyle{firstpage}{%
    \fancyhf{}%
    \fancyhead[C]{\placeClassificationMarkings}%
    \fancyfoot[C]{}%  % No page number on first page
    \renewcommand{\headrulewidth}{0pt}%
    \renewcommand{\footrulewidth}{0pt}%
}

\fancypagestyle{documentpage}{%
    \fancyhf{}%
    \fancyhead[C]{\placeClassificationMarkings}%
    \fancyfoot[C]{\thepage}%
    \renewcommand{\headrulewidth}{0pt}%
    \renewcommand{\footrulewidth}{0pt}%
}
