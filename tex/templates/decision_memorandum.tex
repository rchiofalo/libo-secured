%=============================================================================
%
%                     DECISION MEMORANDUM FORMAT MODULE
%
%=============================================================================
%
% References:
%   - SECNAV M-5216.5 (DON Correspondence Manual), Chapter 10, Para 5
%
% What It's For:
%   Request an approval/disapproval decision from a SINGLE addressee.
%
% Format:
%   Use any memo format (plain-paper or letterhead), then add decision block:
%   - Position: Left margin
%   - Spacing: Two lines below the signature line
%
% Decision Block Format:
%   [ADDRESSEE'S TITLE] DECISION:
%   _____________________ Approved
%   _____________________ Disapproved
%   _____________________ Other
%
%=============================================================================


%=============================================================================
%                     DECISION ADDRESSEE CONFIGURATION
%=============================================================================
% The addressee's title for the decision block (e.g., "COMMANDING OFFICER")

\newcommand{\DecisionAddresseeTitle}{}
\newcommand{\setDecisionAddressee}[1]{\renewcommand{\DecisionAddresseeTitle}{#1}}


%=============================================================================
%                          DATE AND MEMO TITLE
%=============================================================================
% Uses plain-paper style (no letterhead) by default
% Date on line 6, right margin

\newcommand{\printDateAndTitle}{%
    \vspace*{1in}%  % 2" top margin (1" from geometry + 1" here) per SECNAV Ch 12
    \hfill \DocumentDate\\[12pt]
    \noindent MEMORANDUM\\[12pt]
}


%=============================================================================
%              FROM / TO / VIA / SUBJ BLOCK (Plain-Paper Style)
%=============================================================================

\newcommand{\printAddressBlock}{%
    \noindent
    \begin{tabular}[t]{@{}l@{\hspace{1em}}p{5.5in}@{}}
        From: & \FromLine\ifdefempty{\FromLineTwo}{}{\tabularnewline & \FromLineTwo}\ifdefempty{\FromLineThree}{}{\tabularnewline & \FromLineThree}\ifdefempty{\FromLineFour}{}{\tabularnewline & \FromLineFour}\tabularnewline
        To: & \ToLine\ifdefempty{\ToLineTwo}{}{\tabularnewline & \ToLineTwo}\ifdefempty{\ToLineThree}{}{\tabularnewline & \ToLineThree}\ifdefempty{\ToLineFour}{}{\tabularnewline & \ToLineFour}\tabularnewline
        \ifViaEnabled
            Via: & \ViaLineOne\ifdefempty{\ViaLineTwo}{}{\tabularnewline & \ViaLineTwo}\ifdefempty{\ViaLineThree}{}{\tabularnewline & \ViaLineThree}\ifdefempty{\ViaLineFour}{}{\tabularnewline & \ViaLineFour}\tabularnewline
        \fi
        & \tabularnewline[-6pt]
        Subj: & \SubjectLine\tabularnewline
    \end{tabular}%
    %
    % CUI block
    \ifCUIEnabled
        \par\vspace{12pt}%
        \noindent
        Controlled by: \CUIControlledBy\\
        CUI Category: \CUICategory\\
        Limited Dissemination Control: \CUIDissemination\\
        POC: \href{mailto:\POCEmail}{\POCEmail}%
        \par\vspace{12pt}%
        \noindent\CUIDistStatement
    \fi
    %
    % Classified block
    \ifClassifiedEnabled
        \par\vspace{12pt}%
        \noindent
        Classified by: \ClassifiedBy\\
        Derived from: \DerivedFrom\\
        Reason: \ClassificationReason\\
        Declassify on: \DeclassifyOn\\
        POC: \href{mailto:\POCEmail}{\POCEmail}
    \fi
}


%=============================================================================
%         SIGNATURE BLOCK WITH DECISION BLOCK (Decision Memo Style)
%=============================================================================
% Signature is name only
% Decision block: 2 lines below signature, at LEFT margin

\newcommand{\printSignature}{%
    \par\vspace{36pt}%
    \hspace{3.25in}%
    \begin{minipage}{3in}
        \raggedright
        % Optional: Signature image
        \ifNotEmpty{\SignatureImage}{%
            \IfFileExists{attachments/\SignatureImage}{%
                \includegraphics[width=1.5in,height=0.5in,keepaspectratio]{attachments/\SignatureImage}\\[6pt]%
            }{}%
        }%
        % Required: Name only (abbreviated format preferred)
        \ifNotEmptyElse{\SignatoryAbbrev}{\SignatoryAbbrev\\}{\MakeUppercase{\SignatoryName}\\}%
        % Optional: By direction authority line
        \optionalField{\ByDirection}%
    \end{minipage}%
    %
    % Decision Block - 2 lines below signature, at LEFT margin
    \vspace{36pt}%

    \noindent\MakeUppercase{\DecisionAddresseeTitle} DECISION:\\[12pt]
    \noindent\underline{\hspace{2in}} Approved\\[12pt]
    \noindent\underline{\hspace{2in}} Disapproved\\[12pt]
    \noindent\underline{\hspace{2in}} Other%
}


%=============================================================================
%                         LETTERHEAD OVERRIDE
%=============================================================================
% Decision memo typically uses plain paper (no letterhead)

\renewcommand{\printLetterhead}{}


%=============================================================================
%                              PAGE STYLE
%=============================================================================
% SECNAV M-5216.5:
%   - First page: Do NOT number
%   - Second+ pages: Centered, 1/2" from bottom

\fancypagestyle{firstpage}{%
    \fancyhf{}%
    \fancyhead[C]{\placeClassificationMarkings}%
    \fancyfoot[C]{}%  % No page number on first page
    \renewcommand{\headrulewidth}{0pt}%
    \renewcommand{\footrulewidth}{0pt}%
}

\fancypagestyle{documentpage}{%
    \fancyhf{}%
    \fancyhead[C]{\placeClassificationMarkings}%
    \fancyfoot[C]{\thepage}%
    \renewcommand{\headrulewidth}{0pt}%
    \renewcommand{\footrulewidth}{0pt}%
}
