%=============================================================================
%
%                     LETTERHEAD MEMORANDUM FORMAT MODULE
%
%=============================================================================
%
% References:
%   - SECNAV M-5216.5 (DON Correspondence Manual), Chapter 10, Para 4
%   - Figure 10-4
%
% What It's For:
%   More formal than printed form or plain-paper memo. Can be used:
%   - Internally: Within your command for formal matters
%   - Externally (LIMITED): Only when ALL three conditions are met:
%     1. Direct liaison is authorized
%     2. Matter is routine
%     3. Memo does NOT make a commitment or take an official stand
%
% Requirements:
%   - Paper: Command letterhead
%   - SSIC: Required
%   - Originator code: Required (e.g., "Memo S-3/024")
%   - Date: Required
%   - Signature: Name only — full signature line NOT required
%                (From: line identifies signer)
%
%=============================================================================


%=============================================================================
%                    DATE/SSIC BLOCK AND MEMO TITLE
%=============================================================================
% Uses standard letter format but types "MEMORANDUM" instead of
% starting with text.
% SSIC, originator code (Memo XX/###), and date in upper right

\newcommand{\printDateAndTitle}{%
    % Letterhead already provides vertical offset via textblock positioning
    \hfill
    \begin{tabular}[t]{@{}l@{}}
        \ifInReplyEnabled
            {\fontsize{5pt}{6pt}\selectfont IN REPLY REFER TO}\\
        \fi
        \DocumentSSIC\\
        \DocumentSerial\\
        \DocumentDate
    \end{tabular}
    \par\vspace{24pt}%
    \noindent MEMORANDUM
    \par\vspace{12pt}%
}


%=============================================================================
%              FROM / TO / VIA / SUBJ BLOCK (Letterhead Memo Style)
%=============================================================================

\newcommand{\printAddressBlock}{%
    \noindent
    \begin{tabular}[t]{@{}l@{\hspace{1em}}p{5.5in}@{}}
        From: & \FromLine\ifdefempty{\FromLineTwo}{}{\tabularnewline & \FromLineTwo}\ifdefempty{\FromLineThree}{}{\tabularnewline & \FromLineThree}\ifdefempty{\FromLineFour}{}{\tabularnewline & \FromLineFour}\tabularnewline
        To: & \ToLine\ifdefempty{\ToLineTwo}{}{\tabularnewline & \ToLineTwo}\ifdefempty{\ToLineThree}{}{\tabularnewline & \ToLineThree}\ifdefempty{\ToLineFour}{}{\tabularnewline & \ToLineFour}\tabularnewline
        \ifViaEnabled
            Via: & \ViaLineOne\ifdefempty{\ViaLineTwo}{}{\tabularnewline & \ViaLineTwo}\ifdefempty{\ViaLineThree}{}{\tabularnewline & \ViaLineThree}\ifdefempty{\ViaLineFour}{}{\tabularnewline & \ViaLineFour}\tabularnewline
        \fi
        & \tabularnewline[-6pt]
        Subj: & \SubjectLine\tabularnewline
    \end{tabular}%
    %
    % CUI block
    \ifCUIEnabled
        \par\vspace{12pt}%
        \noindent
        Controlled by: \CUIControlledBy\\
        CUI Category: \CUICategory\\
        Limited Dissemination Control: \CUIDissemination\\
        POC: \href{mailto:\POCEmail}{\POCEmail}%
        \par\vspace{12pt}%
        \noindent\CUIDistStatement
    \fi
    %
    % Classified block
    \ifClassifiedEnabled
        \par\vspace{12pt}%
        \noindent
        Classified by: \ClassifiedBy\\
        Derived from: \DerivedFrom\\
        Reason: \ClassificationReason\\
        Declassify on: \DeclassifyOn\\
        POC: \href{mailto:\POCEmail}{\POCEmail}
    \fi
}


%=============================================================================
%                SIGNATURE BLOCK (Letterhead Memo Style)
%=============================================================================
% Signature is name only — NO rank, NO organizational title
% From: line already identifies who's signing
% Per SECNAV Ch 10, Para 4

\newcommand{\printSignature}{%
    \vspace{36pt}%
    \hspace{3.25in}%
    \begin{minipage}{3in}
        \raggedright
        % Optional: Signature image
        \ifNotEmpty{\SignatureImage}{%
            \IfFileExists{attachments/\SignatureImage}{%
                \includegraphics[width=1.5in,height=0.5in,keepaspectratio]{attachments/\SignatureImage}\\[6pt]%
            }{}%
        }%
        % Required: Name only (abbreviated format preferred)
        \ifNotEmptyElse{\SignatoryAbbrev}{\SignatoryAbbrev\\}{\MakeUppercase{\SignatoryName}\\}%
        % Optional: By direction authority line
        \optionalField{\ByDirection}%
    \end{minipage}
}


%=============================================================================
%                              PAGE STYLE
%=============================================================================
% SECNAV M-5216.5:
%   - First page: Do NOT number
%   - Second+ pages: Centered, 1/2" from bottom

\fancypagestyle{firstpage}{%
    \fancyhf{}%
    \fancyhead[C]{\placeClassificationMarkings}%
    \fancyfoot[C]{}%  % No page number on first page
    \renewcommand{\headrulewidth}{0pt}%
    \renewcommand{\footrulewidth}{0pt}%
}

\fancypagestyle{documentpage}{%
    \fancyhf{}%
    \fancyhead[C]{\placeClassificationMarkings}%
    \fancyfoot[C]{\thepage}%
    \renewcommand{\headrulewidth}{0pt}%
    \renewcommand{\footrulewidth}{0pt}%
}
