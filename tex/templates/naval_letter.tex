%=============================================================================
%
%                     STANDARD NAVAL LETTER FORMAT MODULE
%
%=============================================================================
%
% References:
%   - SECNAV M-5216.5 (DON Correspondence Manual), Chapter 2
%   - MCO 5216.20B w/Admin CH-4 (Marine Corps Supplement)
%
% Spacing per SECNAV M-5216.5 Figure 2-1:
%   - From/To/Via: Single-spaced, NO blank lines between them
%   - One blank line before Subj, Ref, Encl, and body paragraph 1
%
%=============================================================================


%=============================================================================
%                    SSIC / SERIAL / DATE BLOCK (Right-aligned)
%=============================================================================

\newcommand{\printDateAndTitle}{%
    \begingroup
    \raggedleft
    % Optional "IN REPLY REFER TO" line per SECNAV M-5216.5 App C, Para 1.a
    \ifInReplyEnabled
        {\fontsize{5pt}{6pt}\selectfont IN REPLY REFER TO}\\
    \fi
    \ifx\DocumentSSIC\empty\else
        \DocumentSSIC\\
    \fi
    \ifx\DocumentSerial\empty\else
        \DocumentSerial\\
    \fi
    \DocumentDate\par
    \endgroup
}


%=============================================================================
%                    FROM / TO / VIA / SUBJ BLOCK
%=============================================================================

% SECNAV M-5216.5 spacing after colons:
%   From:  2 spaces    To:    6 spaces    Via:   5 spaces
%   Subj:  3 spaces    Ref:   4 spaces    Encl:  3 spaces
%
% Second column width: 5.75in to respect 1" right margin
% (textwidth=6.5in minus ~0.75in for labels)
\makeatletter
\newcommand{\printAddressBlock}{%
    \begingroup
    \singlespacing
    \noindent
    % Build Via rows into a macro before the tabular
    \def\@viarows{}%
    \ifViaEnabled
        \def\@viarows{\tabularnewline Via:\hspace{5\fontdimen2\font} & \ViaLineOne}%
        \ifdefempty{\ViaLineTwo}{}{\appto\@viarows{\tabularnewline & \ViaLineTwo}}%
        \ifdefempty{\ViaLineThree}{}{\appto\@viarows{\tabularnewline & \ViaLineThree}}%
        \ifdefempty{\ViaLineFour}{}{\appto\@viarows{\tabularnewline & \ViaLineFour}}%
    \fi
    \begin{tabular}[t]{@{}l@{}p{5.75in}@{}}%
        From:\hspace{2\fontdimen2\font} & \FromLine\ifdefempty{\FromLineTwo}{}{\tabularnewline & \FromLineTwo}\ifdefempty{\FromLineThree}{}{\tabularnewline & \FromLineThree}\ifdefempty{\FromLineFour}{}{\tabularnewline & \FromLineFour}\tabularnewline%
        To:\hspace{6\fontdimen2\font} & \ToLine\ifdefempty{\ToLineTwo}{}{\tabularnewline & \ToLineTwo}\ifdefempty{\ToLineThree}{}{\tabularnewline & \ToLineThree}\ifdefempty{\ToLineFour}{}{\tabularnewline & \ToLineFour}%
        \@viarows
        \tabularnewline[12pt]%
        Subj:\hspace{3\fontdimen2\font} & \SubjectLine%
    \end{tabular}%
    \endgroup
    %
    % CUI block
    \ifCUIEnabled
        \par\vspace{12pt}
        \noindent Controlled by: \CUIControlledBy\\
        CUI Category: \CUICategory\\
        Limited Dissemination Control: \CUIDissemination\\
        POC: \href{mailto:\POCEmail}{\POCEmail}%
        \par\vspace{12pt}
        \noindent\CUIDistStatement
    \fi
    %
    % Classified block
    \ifClassifiedEnabled
        \par\vspace{12pt}
        \noindent Classified by: \ClassifiedBy\\
        Derived from: \DerivedFrom\\
        Reason: \ClassificationReason\\
        Declassify on: \DeclassifyOn\\
        POC: \href{mailto:\POCEmail}{\POCEmail}
    \fi
}
\makeatother


%=============================================================================
%                  SIGNATURE BLOCK (Naval Letter Style)
%=============================================================================
% SECNAV M-5216.5 Ch 7, Para 14.a:
%   - Position: Center of page, fourth line below text
%   - Format: First initial, middle initial, LAST NAME (caps)
%   - Example: J. M. SMITH
%   - No rank, no complimentary close
%
% Use \setSignatoryAbbrev{J. M. SMITH} in config/signatory.tex

\newcommand{\printSignature}{%
    \vspace{48pt}%  % 4 blank lines below text per SECNAV Ch 7, Para 14
    \hspace{3.25in}%
    \begin{minipage}{3in}
        \raggedright
        % Optional: Signature image
        \ifNotEmpty{\SignatureImage}{%
            \IfFileExists{attachments/\SignatureImage}{%
                \includegraphics[width=1.5in,height=0.5in,keepaspectratio]{attachments/\SignatureImage}\\[6pt]%
            }{}%
        }%
        % Required: Use abbreviated format (J. M. LASTNAME) if set, otherwise full name
        \ifNotEmptyElse{\SignatoryAbbrev}{\SignatoryAbbrev\\}{\MakeUppercase{\SignatoryName}\\}%
        % Optional: By direction authority line (e.g., "By direction")
        \optionalField{\ByDirection}%
    \end{minipage}
}


%=============================================================================
%                              PAGE STYLE
%=============================================================================
% SECNAV M-5216.5 Ch 7, Para 17:
%   - First page: Do NOT number
%   - Second+ pages: Start with "2", centered, Â½" from bottom
%   - No punctuation (just the number)

\fancypagestyle{firstpage}{%
    \fancyhf{}%
    \fancyhead[C]{\placeClassificationMarkings}%
    \fancyfoot[C]{}%  % No page number on first page
    \renewcommand{\headrulewidth}{0pt}%
    \renewcommand{\footrulewidth}{0pt}%
}

\fancypagestyle{documentpage}{%
    \fancyhf{}%
    \fancyhead[C]{\placeClassificationMarkings}%
    \fancyfoot[C]{\thepage}%  % Just the number, no "of X"
    \renewcommand{\headrulewidth}{0pt}%
    \renewcommand{\footrulewidth}{0pt}%
}
