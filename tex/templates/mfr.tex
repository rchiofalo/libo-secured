%=============================================================================
%
%                     MFR (MEMORANDUM FOR THE RECORD) FORMAT MODULE
%
%=============================================================================
%
% References:
%   - SECNAV M-5216.5 (DON Correspondence Manual), Chapter 10
%   - MCO 5216.20B w/Admin CH-4 (Marine Corps Supplement)
%
% Spacing per SECNAV M-5216.5:
%   - From/To: Single-spaced, NO blank lines between them
%   - One blank line before Subj, Ref, Encl, and body paragraph 1
%
%=============================================================================


%=============================================================================
%                          DATE AND MEMO TITLE
%=============================================================================

\newcommand{\printDateAndTitle}{%
    \hfill \DocumentDate\\[12pt]
    \begin{center}
        MEMORANDUM FOR THE RECORD
    \end{center}
    \vspace{12pt}% One blank line between title and From/To block
}


%=============================================================================
%                    FROM / TO / SUBJ BLOCK (MFR Style)
%=============================================================================

\newcommand{\printAddressBlock}{%
    \noindent
    \begin{tabular}[t]{@{}l@{\hspace{1em}}p{5.5in}@{}}
        From: & \FromLine\ifdefempty{\FromLineTwo}{}{\tabularnewline & \FromLineTwo}\ifdefempty{\FromLineThree}{}{\tabularnewline & \FromLineThree}\ifdefempty{\FromLineFour}{}{\tabularnewline & \FromLineFour}\tabularnewline
        \ifdefempty{\ToLine}{}{To: & \ToLine\ifdefempty{\ToLineTwo}{}{\tabularnewline & \ToLineTwo}\ifdefempty{\ToLineThree}{}{\tabularnewline & \ToLineThree}\ifdefempty{\ToLineFour}{}{\tabularnewline & \ToLineFour}\tabularnewline}
        & \tabularnewline[-6pt]
        Subj: & \SubjectLine\tabularnewline
    \end{tabular}%
    %
    % CUI block
    \ifCUIEnabled
        \par\vspace{12pt}%
        \noindent
        Controlled by: \CUIControlledBy\\
        CUI Category: \CUICategory\\
        Limited Dissemination Control: \CUIDissemination\\
        POC: \href{mailto:\POCEmail}{\POCEmail}%
        \par\vspace{12pt}%
        \noindent\CUIDistStatement
    \fi
    %
    % Classified block
    \ifClassifiedEnabled
        \par\vspace{12pt}%
        \noindent
        Classified by: \ClassifiedBy\\
        Derived from: \DerivedFrom\\
        Reason: \ClassificationReason\\
        Declassify on: \DeclassifyOn\\
        POC: \href{mailto:\POCEmail}{\POCEmail}
    \fi
}


%=============================================================================
%                       SIGNATURE BLOCK (MFR Style)
%=============================================================================

\newcommand{\printSignature}{%
    \vspace{36pt}%
    \hspace{3.25in}%
    \begin{minipage}{3in}
        \raggedright
        % Optional: Signature image
        \ifNotEmpty{\SignatureImage}{%
            \IfFileExists{attachments/\SignatureImage}{%
                \includegraphics[width=1.5in,height=0.5in,keepaspectratio]{attachments/\SignatureImage}\\[6pt]%
            }{}%
        }%
        % Required: Name (use abbreviated if available, else full name uppercased)
        \ifNotEmptyElse{\SignatoryAbbrev}{\SignatoryAbbrev\\}{\MakeUppercase{\SignatoryName}\\}%
        % Optional: Rank and Title
        \optionalLine{\SignatoryRank}%
        \optionalLine{\SignatoryTitle}%
        % Optional: By direction authority line
        \optionalField{\ByDirection}%
    \end{minipage}
}


%=============================================================================
%                              PAGE STYLE
%=============================================================================
% SECNAV M-5216.5:
%   - First page: Do NOT number
%   - Second+ pages: Centered, 1/2" from bottom

\fancypagestyle{firstpage}{%
    \fancyhf{}%
    \fancyhead[C]{\placeClassificationMarkings}%
    \fancyfoot[C]{}%  % No page number on first page
    \renewcommand{\headrulewidth}{0pt}%
    \renewcommand{\footrulewidth}{0pt}%
}

\fancypagestyle{documentpage}{%
    \fancyhf{}%
    \fancyhead[C]{\placeClassificationMarkings}%
    \fancyfoot[C]{\thepage}%
    \renewcommand{\headrulewidth}{0pt}%
    \renewcommand{\footrulewidth}{0pt}%
}
